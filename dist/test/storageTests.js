/* eslint-env node */
/* eslint no-shadow: 0, max-len: 0 */
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var index_1 = require("../src/index");
var testType_1 = require("./testType");
var Bluebird = require("bluebird");
var mergeOptions = require("merge-options");
Bluebird.config({
    longStackTraces: true,
});
var chai = require("chai");
var chaiAsPromised = require("chai-as-promised");
chai.use(chaiAsPromised);
var expect = chai.expect;
var sampleObject = {
    typeName: 'tests',
    attributes: {
        name: 'potato',
        extended: {
            actual: 'rutabaga',
            otherValue: 42,
        },
    },
    relationships: {},
};
function testSuite(mocha, storeOpts) {
    var store = Object.assign({}, {
        before: function () { return Bluebird.resolve(); },
        after: function () { return Bluebird.resolve(); },
    }, storeOpts);
    mocha.describe(store.name, function () {
        var actualStore;
        mocha.before(function () {
            return (store.before || (function () { return Bluebird.resolve(); }))(actualStore)
                .then(function () {
                actualStore = new store.ctor(store.opts); // eslint-disable-line new-cap
                actualStore.addSchema(testType_1.TestType);
            });
        });
        mocha.describe('core CRUD', function () {
            mocha.it('supports creating values with no id field, and retrieving values', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['attributes', 'relationships'])
                        .then(function (v) {
                        return expect(v)
                            .to.deep.equal(mergeOptions({}, sampleObject, {
                            id: createdObject.id,
                            relationships: {
                                parents: [],
                                children: [],
                                valenceParents: [],
                                valenceChildren: [],
                                queryParents: [],
                                queryChildren: [],
                            },
                            attributes: {
                                id: createdObject.id,
                                otherName: '',
                            },
                        }));
                    });
                });
            });
            mocha.it('allows objects to be stored by id', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    var modObject = mergeOptions({}, createdObject, { attributes: { name: 'carrot' } });
                    return actualStore.writeAttributes(modObject)
                        .then(function (updatedObject) {
                        return expect(actualStore.read({ typeName: 'tests', id: updatedObject.id }, 'attributes'))
                            .to.eventually.deep.equal(mergeOptions({}, modObject, {
                            id: createdObject.id,
                            relationships: {},
                            attributes: {
                                id: createdObject.id,
                                otherName: '',
                            },
                        }));
                    });
                });
            });
            mocha.it('allows for deletion of objects by id', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return expect(actualStore.read({ typeName: 'tests', id: createdObject.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato')
                        .then(function () { return actualStore.delete({ typeName: 'tests', id: createdObject.id }); })
                        .then(function () { return expect(actualStore.read({ typeName: 'tests', id: createdObject.id })).to.eventually.be.null; });
                });
            });
        });
        mocha.describe('relationships', function () {
            mocha.it('can fetch a base and hasmany in one read', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 200 })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 201 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 202 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 203 }); })
                        .then(function () {
                        return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['attributes', 'relationships.children']);
                    })
                        .then(function (v) {
                        expect(v).to.have.deep.property('attributes.name', 'potato');
                        expect(v.relationships.children).to.deep.equal([{ id: 200 }, { id: 201 }, { id: 202 }, { id: 203 }]);
                    });
                });
            });
            mocha.it('can add to a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 101 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 102 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 103 }); })
                        .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: 100 }, 'children', { id: createdObject.id }); })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['relationships.children']); })
                        .then(function (v) {
                        expect(v.relationships.children).to.deep.equal([
                            { id: 100 },
                            { id: 101 },
                            { id: 102 },
                            { id: 103 },
                        ]);
                        return actualStore.read({ typeName: 'tests', id: createdObject.id }, ['relationships.parents']);
                    })
                        .then(function (v) { return expect(v.relationships.parents).to.deep.equal([{ id: 100 }]); });
                });
            });
            mocha.it('can add to a hasMany relationship with extras', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 1 } })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 1 } }]); });
                });
            });
            mocha.it('can modify valence on a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 1 } })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 1 } }]); })
                        .then(function () {
                        return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'valenceChildren', { id: 100, meta: { perm: 2 } });
                    })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.valenceChildren'); })
                        .then(function (v) { return expect(v.relationships.valenceChildren).to.deep.equal([{ id: 100, meta: { perm: 2 } }]); });
                });
            });
            mocha.it('can remove from a hasMany relationship', function () {
                return actualStore.writeAttributes(sampleObject)
                    .then(function (createdObject) {
                    return actualStore.writeRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.children'); })
                        .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                        .then(function () { return actualStore.deleteRelationshipItem({ typeName: 'tests', id: createdObject.id }, 'children', { id: 100 }); })
                        .then(function () { return actualStore.read({ typeName: 'tests', id: createdObject.id }, 'relationships.children'); })
                        .then(function (v) { return expect(v.relationships.children).to.deep.equal([]); });
                });
            });
        });
        mocha.describe('events', function () {
            mocha.it('should pass basic write-invalidation events to other datastores', function () {
                var memstore = new index_1.MemoryStore();
                var testPlump = new index_1.Plump({
                    storage: [memstore, actualStore],
                    types: [testType_1.TestType],
                });
                return actualStore.writeAttributes({
                    typeName: 'tests',
                    attributes: { name: 'potato' },
                }).then(function (createdObject) {
                    return actualStore.read({ typeName: 'tests', id: createdObject.id })
                        .then(function () {
                        return new Bluebird(function (resolve) { return setTimeout(resolve, 100); })
                            .then(function () {
                            return expect(memstore.read({ typeName: 'tests', id: createdObject.id }))
                                .to.eventually.have.deep.property('attributes.name', 'potato');
                        }).then(function () {
                            return actualStore.writeAttributes({
                                typeName: 'tests',
                                id: createdObject.id,
                                attributes: {
                                    name: 'grotato',
                                },
                            });
                        }).then(function () {
                            return new Bluebird(function (resolve) { return setTimeout(resolve, 100); });
                        }).then(function () {
                            return expect(memstore.read({ typeName: 'tests', id: createdObject.id }))
                                .to.eventually.be.null;
                        });
                    });
                }).finally(function () {
                    return testPlump.teardown();
                });
            });
            mocha.it('should pass basic cacheable-read events up the stack', function () {
                var testPlump = new index_1.Plump({ types: [testType_1.TestType] });
                var testItem;
                var memstore;
                return actualStore.writeAttributes({
                    typeName: 'tests',
                    attributes: { name: 'potato' },
                }).then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () {
                    memstore = new index_1.MemoryStore();
                    testPlump.addStore(memstore);
                    testPlump.addStore(actualStore);
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id })).to.eventually.be.null;
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id });
                })
                    .then(function () {
                    // NOTE: this timeout is a hack, it is because
                    // cacheable read events trigger multiple async things, but don't block
                    // the promise from returning
                    return new Bluebird(function (resolve) { return setTimeout(resolve, 100); });
                })
                    .then(function () {
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).finally(function () { return testPlump.teardown(); });
            });
            mocha.it('should pass write-invalidation events on hasMany relationships to other datastores', function () {
                var testItem;
                var memstore = new index_1.MemoryStore();
                var testPlump = new index_1.Plump({
                    storage: [memstore, actualStore],
                    types: [testType_1.TestType],
                });
                return actualStore.writeAttributes({
                    typeName: 'tests',
                    attributes: { name: 'potato' },
                }).then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 100 }); })
                    .then(function () {
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.not.have.deep.property('relationships.children');
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id }, 'children');
                }).then(function () {
                    // NOTE: this timeout is a hack, it is because
                    // cacheable read events trigger multiple async things, but don't block
                    // the promise from returning
                    return new Bluebird(function (resolve) { return setTimeout(resolve, 100); });
                })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }, 'children'); })
                    .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                    .then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 101 }); })
                    .then(function () { return new Bluebird(function (resolve) { return setTimeout(resolve, 100); }); })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }); })
                    .then(function (v) { return expect(v).to.not.have.deep.property('relationships.children'); })
                    .finally(function () { return testPlump.teardown(); });
            });
            mocha.it('should pass cacheable-read events on hasMany relationships to other datastores', function () {
                var testPlump = new index_1.Plump({ types: [testType_1.TestType] });
                var testItem;
                var memstore;
                return actualStore.writeAttributes({
                    typeName: 'tests',
                    attributes: { name: 'potato' },
                }).then(function (createdObject) {
                    testItem = createdObject;
                    return expect(actualStore.read({ typeName: 'tests', id: testItem.id }))
                        .to.eventually.have.deep.property('attributes.name', 'potato');
                }).then(function () { return actualStore.writeRelationshipItem({ typeName: 'tests', id: testItem.id }, 'children', { id: 100 }); })
                    .then(function () {
                    memstore = new index_1.MemoryStore();
                    testPlump.addStore(actualStore);
                    testPlump.addStore(memstore);
                    return expect(memstore.read({ typeName: 'tests', id: testItem.id })).to.eventually.be.null;
                }).then(function () {
                    return actualStore.read({ typeName: 'tests', id: testItem.id }, 'children');
                }).then(function () { return new Bluebird(function (resolve) { return setTimeout(resolve, 100); }); })
                    .then(function () { return memstore.read({ typeName: 'tests', id: testItem.id }, 'children'); })
                    .then(function (v) { return expect(v.relationships.children).to.deep.equal([{ id: 100 }]); })
                    .finally(function () { return testPlump.teardown(); });
            });
        });
        mocha.after(function () {
            return (store.after || (function () { return; }))(actualStore);
        });
    });
}
exports.testSuite = testSuite;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFJLENBQUMsY0FBUSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBM1NELDhCQTJTQyIsImZpbGUiOiJzdG9yYWdlVGVzdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZW52IG5vZGUgKi9cbi8qIGVzbGludCBuby1zaGFkb3c6IDAsIG1heC1sZW46IDAgKi9cblxuaW1wb3J0IHsgTWVtb3J5U3RvcmUsIFBsdW1wIH0gZnJvbSAnLi4vc3JjL2luZGV4JztcbmltcG9ydCB7IFRlc3RUeXBlIH0gZnJvbSAnLi90ZXN0VHlwZSc7XG5pbXBvcnQgKiBhcyBJbnRlcmZhY2VzIGZyb20gJy4uL3NyYy9kYXRhVHlwZXMnO1xuaW1wb3J0ICogYXMgQmx1ZWJpcmQgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0ICogYXMgbWVyZ2VPcHRpb25zIGZyb20gJ21lcmdlLW9wdGlvbnMnO1xuXG5CbHVlYmlyZC5jb25maWcoe1xuICBsb25nU3RhY2tUcmFjZXM6IHRydWUsXG59KTtcblxuaW1wb3J0ICogYXMgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCAqIGFzIGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuY2hhaS51c2UoY2hhaUFzUHJvbWlzZWQpO1xuXG5jb25zdCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxuY29uc3Qgc2FtcGxlT2JqZWN0ID0ge1xuICB0eXBlTmFtZTogJ3Rlc3RzJyxcbiAgYXR0cmlidXRlczoge1xuICAgIG5hbWU6ICdwb3RhdG8nLFxuICAgIGV4dGVuZGVkOiB7XG4gICAgICBhY3R1YWw6ICdydXRhYmFnYScsXG4gICAgICBvdGhlclZhbHVlOiA0MixcbiAgICB9LFxuICB9LFxuICByZWxhdGlvbnNoaXBzOiB7fSxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB0ZXN0U3VpdGUobW9jaGEsIHN0b3JlT3B0cykge1xuICBjb25zdCBzdG9yZSA9IE9iamVjdC5hc3NpZ24oXG4gICAge30sXG4gICAge1xuICAgICAgYmVmb3JlOiAoKSA9PiBCbHVlYmlyZC5yZXNvbHZlKCksXG4gICAgICBhZnRlcjogKCkgPT4gQmx1ZWJpcmQucmVzb2x2ZSgpLFxuICAgIH0sXG4gICAgc3RvcmVPcHRzXG4gICk7XG4gIG1vY2hhLmRlc2NyaWJlKHN0b3JlLm5hbWUsICgpID0+IHtcbiAgICBsZXQgYWN0dWFsU3RvcmU7XG4gICAgbW9jaGEuYmVmb3JlKCgpID0+IHtcbiAgICAgIHJldHVybiAoc3RvcmUuYmVmb3JlIHx8ICgoKSA9PiBCbHVlYmlyZC5yZXNvbHZlKCkpKShhY3R1YWxTdG9yZSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgYWN0dWFsU3RvcmUgPSBuZXcgc3RvcmUuY3RvcihzdG9yZS5vcHRzKTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuZXctY2FwXG4gICAgICAgIGFjdHVhbFN0b3JlLmFkZFNjaGVtYShUZXN0VHlwZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIG1vY2hhLmRlc2NyaWJlKCdjb3JlIENSVUQnLCAoKSA9PiB7XG4gICAgICBtb2NoYS5pdCgnc3VwcG9ydHMgY3JlYXRpbmcgdmFsdWVzIHdpdGggbm8gaWQgZmllbGQsIGFuZCByZXRyaWV2aW5nIHZhbHVlcycsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhzYW1wbGVPYmplY3QpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgWydhdHRyaWJ1dGVzJywgJ3JlbGF0aW9uc2hpcHMnXSlcbiAgICAgICAgICAudGhlbigodikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGV4cGVjdCh2KVxuICAgICAgICAgICAgLnRvLmRlZXAuZXF1YWwoXG4gICAgICAgICAgICAgIG1lcmdlT3B0aW9ucyh7fSwgc2FtcGxlT2JqZWN0LCB7XG4gICAgICAgICAgICAgICAgaWQ6IGNyZWF0ZWRPYmplY3QuaWQsXG4gICAgICAgICAgICAgICAgcmVsYXRpb25zaGlwczoge1xuICAgICAgICAgICAgICAgICAgcGFyZW50czogW10sXG4gICAgICAgICAgICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgICAgICAgICAgICB2YWxlbmNlUGFyZW50czogW10sXG4gICAgICAgICAgICAgICAgICB2YWxlbmNlQ2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgICAgcXVlcnlQYXJlbnRzOiBbXSxcbiAgICAgICAgICAgICAgICAgIHF1ZXJ5Q2hpbGRyZW46IFtdLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgaWQ6IGNyZWF0ZWRPYmplY3QuaWQsXG4gICAgICAgICAgICAgICAgICBvdGhlck5hbWU6ICcnLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NoYS5pdCgnYWxsb3dzIG9iamVjdHMgdG8gYmUgc3RvcmVkIGJ5IGlkJywgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHNhbXBsZU9iamVjdClcbiAgICAgICAgLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICBjb25zdCBtb2RPYmplY3QgPSBtZXJnZU9wdGlvbnMoe30sIGNyZWF0ZWRPYmplY3QsIHsgYXR0cmlidXRlczogeyBuYW1lOiAnY2Fycm90JyB9IH0pO1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMobW9kT2JqZWN0KVxuICAgICAgICAgIC50aGVuKCh1cGRhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZXhwZWN0KGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHVwZGF0ZWRPYmplY3QuaWQgfSwgJ2F0dHJpYnV0ZXMnKSlcbiAgICAgICAgICAgICAgLnRvLmV2ZW50dWFsbHkuZGVlcC5lcXVhbChcbiAgICAgICAgICAgICAgbWVyZ2VPcHRpb25zKHt9LCBtb2RPYmplY3QsIHtcbiAgICAgICAgICAgICAgICBpZDogY3JlYXRlZE9iamVjdC5pZCxcbiAgICAgICAgICAgICAgICByZWxhdGlvbnNoaXBzOiB7fSxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICBpZDogY3JlYXRlZE9iamVjdC5pZCxcbiAgICAgICAgICAgICAgICAgIG90aGVyTmFtZTogJycsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2hhLml0KCdhbGxvd3MgZm9yIGRlbGV0aW9uIG9mIG9iamVjdHMgYnkgaWQnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9KSlcbiAgICAgICAgICAudG8uZXZlbnR1YWxseS5oYXZlLmRlZXAucHJvcGVydHkoJ2F0dHJpYnV0ZXMubmFtZScsICdwb3RhdG8nKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLmRlbGV0ZSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9KSkudG8uZXZlbnR1YWxseS5iZS5udWxsKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIG1vY2hhLmRlc2NyaWJlKCdyZWxhdGlvbnNoaXBzJywgKCkgPT4ge1xuICAgICAgbW9jaGEuaXQoJ2NhbiBmZXRjaCBhIGJhc2UgYW5kIGhhc21hbnkgaW4gb25lIHJlYWQnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMjAwIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdjaGlsZHJlbicsIHsgaWQ6IDIwMSB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMjAyIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAyMDMgfSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgWydhdHRyaWJ1dGVzJywgJ3JlbGF0aW9uc2hpcHMuY2hpbGRyZW4nXSk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICAudGhlbigodikgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KHYpLnRvLmhhdmUuZGVlcC5wcm9wZXJ0eSgnYXR0cmlidXRlcy5uYW1lJywgJ3BvdGF0bycpO1xuICAgICAgICAgICAgZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbeyBpZDogMjAwIH0sIHsgaWQ6IDIwMSB9LCB7IGlkOiAyMDIgfSwgeyBpZDogMjAzIH1dKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgbW9jaGEuaXQoJ2NhbiBhZGQgdG8gYSBoYXNNYW55IHJlbGF0aW9uc2hpcCcsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhzYW1wbGVPYmplY3QpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDAgfSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAxIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDIgfSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdjaGlsZHJlbicsIHsgaWQ6IDEwMyB9KSlcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IDEwMCB9LCAnY2hpbGRyZW4nLCB7IGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgWydyZWxhdGlvbnNoaXBzLmNoaWxkcmVuJ10pKVxuICAgICAgICAgIC50aGVuKCh2KSA9PiB7XG4gICAgICAgICAgICBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFtcbiAgICAgICAgICAgICAgeyBpZDogMTAwIH0sXG4gICAgICAgICAgICAgIHsgaWQ6IDEwMSB9LFxuICAgICAgICAgICAgICB7IGlkOiAxMDIgfSxcbiAgICAgICAgICAgICAgeyBpZDogMTAzIH0sXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sIFsncmVsYXRpb25zaGlwcy5wYXJlbnRzJ10pO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLnRoZW4oKHY6IEludGVyZmFjZXMuTW9kZWxEYXRhKSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLnBhcmVudHMpLnRvLmRlZXAuZXF1YWwoW3sgaWQ6IDEwMCB9XSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NoYS5pdCgnY2FuIGFkZCB0byBhIGhhc01hbnkgcmVsYXRpb25zaGlwIHdpdGggZXh0cmFzJywgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHNhbXBsZU9iamVjdClcbiAgICAgICAgLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKFxuICAgICAgICAgICAgeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSxcbiAgICAgICAgICAgICd2YWxlbmNlQ2hpbGRyZW4nLFxuICAgICAgICAgICAgeyBpZDogMTAwLCBtZXRhOiB7IHBlcm06IDEgfSB9XG4gICAgICAgICAgKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ3JlbGF0aW9uc2hpcHMudmFsZW5jZUNoaWxkcmVuJykpXG4gICAgICAgICAgLnRoZW4oKHYpID0+IGV4cGVjdCh2LnJlbGF0aW9uc2hpcHMudmFsZW5jZUNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFt7IGlkOiAxMDAsIG1ldGE6IHsgcGVybTogMSB9IH1dKSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2hhLml0KCdjYW4gbW9kaWZ5IHZhbGVuY2Ugb24gYSBoYXNNYW55IHJlbGF0aW9uc2hpcCcsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyhzYW1wbGVPYmplY3QpXG4gICAgICAgIC50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbShcbiAgICAgICAgICAgIHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sXG4gICAgICAgICAgICAndmFsZW5jZUNoaWxkcmVuJyxcbiAgICAgICAgICAgIHsgaWQ6IDEwMCwgbWV0YTogeyBwZXJtOiAxIH0gfVxuICAgICAgICAgIClcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdyZWxhdGlvbnNoaXBzLnZhbGVuY2VDaGlsZHJlbicpKVxuICAgICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLnZhbGVuY2VDaGlsZHJlbikudG8uZGVlcC5lcXVhbChbeyBpZDogMTAwLCBtZXRhOiB7IHBlcm06IDEgfSB9XSkpXG4gICAgICAgICAgLnRoZW4oKCkgPT5cbiAgICAgICAgICAgIGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbShcbiAgICAgICAgICAgICAgeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSxcbiAgICAgICAgICAgICAgJ3ZhbGVuY2VDaGlsZHJlbicsIHsgaWQ6IDEwMCwgbWV0YTogeyBwZXJtOiAyIH0gfVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAudGhlbigoKSA9PiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0sICdyZWxhdGlvbnNoaXBzLnZhbGVuY2VDaGlsZHJlbicpKVxuICAgICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLnZhbGVuY2VDaGlsZHJlbikudG8uZGVlcC5lcXVhbChbeyBpZDogMTAwLCBtZXRhOiB7IHBlcm06IDIgfSB9XSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NoYS5pdCgnY2FuIHJlbW92ZSBmcm9tIGEgaGFzTWFueSByZWxhdGlvbnNoaXAnLCAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZUF0dHJpYnV0ZXMoc2FtcGxlT2JqZWN0KVxuICAgICAgICAudGhlbigoY3JlYXRlZE9iamVjdCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS53cml0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAwIH0pXG4gICAgICAgICAgLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9LCAncmVsYXRpb25zaGlwcy5jaGlsZHJlbicpKVxuICAgICAgICAgIC50aGVuKCh2KSA9PiBleHBlY3Qodi5yZWxhdGlvbnNoaXBzLmNoaWxkcmVuKS50by5kZWVwLmVxdWFsKFt7IGlkOiAxMDAgfV0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLmRlbGV0ZVJlbGF0aW9uc2hpcEl0ZW0oeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAwIH0pKVxuICAgICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSwgJ3JlbGF0aW9uc2hpcHMuY2hpbGRyZW4nKSlcbiAgICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbXSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgbW9jaGEuZGVzY3JpYmUoJ2V2ZW50cycsICgpID0+IHtcbiAgICAgIG1vY2hhLml0KCdzaG91bGQgcGFzcyBiYXNpYyB3cml0ZS1pbnZhbGlkYXRpb24gZXZlbnRzIHRvIG90aGVyIGRhdGFzdG9yZXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG1lbXN0b3JlID0gbmV3IE1lbW9yeVN0b3JlKCk7XG4gICAgICAgIGNvbnN0IHRlc3RQbHVtcCA9IG5ldyBQbHVtcCh7XG4gICAgICAgICAgc3RvcmFnZTogW21lbXN0b3JlLCBhY3R1YWxTdG9yZV0sXG4gICAgICAgICAgdHlwZXM6IFtUZXN0VHlwZV0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHtcbiAgICAgICAgICB0eXBlTmFtZTogJ3Rlc3RzJyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IG5hbWU6ICdwb3RhdG8nIH0sXG4gICAgICAgIH0pLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogY3JlYXRlZE9iamVjdC5pZCB9KVxuICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSlcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIGV4cGVjdChtZW1zdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiBjcmVhdGVkT2JqZWN0LmlkIH0pKVxuICAgICAgICAgICAgICAudG8uZXZlbnR1YWxseS5oYXZlLmRlZXAucHJvcGVydHkoJ2F0dHJpYnV0ZXMubmFtZScsICdwb3RhdG8nKTtcbiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHtcbiAgICAgICAgICAgICAgICB0eXBlTmFtZTogJ3Rlc3RzJyxcbiAgICAgICAgICAgICAgICBpZDogY3JlYXRlZE9iamVjdC5pZCxcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGVzOiB7XG4gICAgICAgICAgICAgICAgICBuYW1lOiAnZ3JvdGF0bycsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbHVlYmlyZCgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IGNyZWF0ZWRPYmplY3QuaWQgfSkpXG4gICAgICAgICAgICAgIC50by5ldmVudHVhbGx5LmJlLm51bGw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHRlc3RQbHVtcC50ZWFyZG93bigpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NoYS5pdCgnc2hvdWxkIHBhc3MgYmFzaWMgY2FjaGVhYmxlLXJlYWQgZXZlbnRzIHVwIHRoZSBzdGFjaycsICgpID0+IHtcbiAgICAgICAgY29uc3QgdGVzdFBsdW1wID0gbmV3IFBsdW1wKHsgdHlwZXM6IFtUZXN0VHlwZV0gfSk7XG4gICAgICAgIGxldCB0ZXN0SXRlbTtcbiAgICAgICAgbGV0IG1lbXN0b3JlO1xuICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUud3JpdGVBdHRyaWJ1dGVzKHtcbiAgICAgICAgICB0eXBlTmFtZTogJ3Rlc3RzJyxcbiAgICAgICAgICBhdHRyaWJ1dGVzOiB7IG5hbWU6ICdwb3RhdG8nIH0sXG4gICAgICAgIH0pLnRoZW4oKGNyZWF0ZWRPYmplY3QpID0+IHtcbiAgICAgICAgICB0ZXN0SXRlbSA9IGNyZWF0ZWRPYmplY3Q7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdChhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9KSlcbiAgICAgICAgICAudG8uZXZlbnR1YWxseS5oYXZlLmRlZXAucHJvcGVydHkoJ2F0dHJpYnV0ZXMubmFtZScsICdwb3RhdG8nKTtcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgbWVtc3RvcmUgPSBuZXcgTWVtb3J5U3RvcmUoKTtcbiAgICAgICAgICB0ZXN0UGx1bXAuYWRkU3RvcmUobWVtc3RvcmUpO1xuICAgICAgICAgIHRlc3RQbHVtcC5hZGRTdG9yZShhY3R1YWxTdG9yZSk7XG4gICAgICAgICAgcmV0dXJuIGV4cGVjdChtZW1zdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9KSkudG8uZXZlbnR1YWxseS5iZS5udWxsO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBOT1RFOiB0aGlzIHRpbWVvdXQgaXMgYSBoYWNrLCBpdCBpcyBiZWNhdXNlXG4gICAgICAgICAgLy8gY2FjaGVhYmxlIHJlYWQgZXZlbnRzIHRyaWdnZXIgbXVsdGlwbGUgYXN5bmMgdGhpbmdzLCBidXQgZG9uJ3QgYmxvY2tcbiAgICAgICAgICAvLyB0aGUgcHJvbWlzZSBmcm9tIHJldHVybmluZ1xuICAgICAgICAgIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKVxuICAgICAgICAgIC50by5ldmVudHVhbGx5LmhhdmUuZGVlcC5wcm9wZXJ0eSgnYXR0cmlidXRlcy5uYW1lJywgJ3BvdGF0bycpO1xuICAgICAgICB9KS5maW5hbGx5KCgpID0+IHRlc3RQbHVtcC50ZWFyZG93bigpKTtcbiAgICAgIH0pO1xuXG4gICAgICBtb2NoYS5pdCgnc2hvdWxkIHBhc3Mgd3JpdGUtaW52YWxpZGF0aW9uIGV2ZW50cyBvbiBoYXNNYW55IHJlbGF0aW9uc2hpcHMgdG8gb3RoZXIgZGF0YXN0b3JlcycsICgpID0+IHtcbiAgICAgICAgbGV0IHRlc3RJdGVtO1xuICAgICAgICBjb25zdCBtZW1zdG9yZSA9IG5ldyBNZW1vcnlTdG9yZSgpO1xuICAgICAgICBjb25zdCB0ZXN0UGx1bXAgPSBuZXcgUGx1bXAoe1xuICAgICAgICAgIHN0b3JhZ2U6IFttZW1zdG9yZSwgYWN0dWFsU3RvcmVdLFxuICAgICAgICAgIHR5cGVzOiBbVGVzdFR5cGVdLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyh7XG4gICAgICAgICAgdHlwZU5hbWU6ICd0ZXN0cycsXG4gICAgICAgICAgYXR0cmlidXRlczogeyBuYW1lOiAncG90YXRvJyB9LFxuICAgICAgICB9KS50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgdGVzdEl0ZW0gPSBjcmVhdGVkT2JqZWN0O1xuICAgICAgICAgIHJldHVybiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpXG4gICAgICAgICAgLnRvLmV2ZW50dWFsbHkuaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJyk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDAgfSkpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKVxuICAgICAgICAgIC50by5ldmVudHVhbGx5Lm5vdC5oYXZlLmRlZXAucHJvcGVydHkoJ3JlbGF0aW9uc2hpcHMuY2hpbGRyZW4nKTtcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0sICdjaGlsZHJlbicpO1xuICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAvLyBOT1RFOiB0aGlzIHRpbWVvdXQgaXMgYSBoYWNrLCBpdCBpcyBiZWNhdXNlXG4gICAgICAgICAgLy8gY2FjaGVhYmxlIHJlYWQgZXZlbnRzIHRyaWdnZXIgbXVsdGlwbGUgYXN5bmMgdGhpbmdzLCBidXQgZG9uJ3QgYmxvY2tcbiAgICAgICAgICAvLyB0aGUgcHJvbWlzZSBmcm9tIHJldHVybmluZ1xuICAgICAgICAgIHJldHVybiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICAgIH0pXG4gICAgICAgIC50aGVuKCgpID0+IG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0sICdjaGlsZHJlbicpKVxuICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbe2lkOiAxMDB9XSkpXG4gICAgICAgIC50aGVuKCgpID0+IGFjdHVhbFN0b3JlLndyaXRlUmVsYXRpb25zaGlwSXRlbSh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSwgJ2NoaWxkcmVuJywgeyBpZDogMTAxIH0pKVxuICAgICAgICAudGhlbigoKSA9PiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSkpXG4gICAgICAgIC50aGVuKCgpID0+IG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKVxuICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYpLnRvLm5vdC5oYXZlLmRlZXAucHJvcGVydHkoJ3JlbGF0aW9uc2hpcHMuY2hpbGRyZW4nKSlcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4gdGVzdFBsdW1wLnRlYXJkb3duKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIG1vY2hhLml0KCdzaG91bGQgcGFzcyBjYWNoZWFibGUtcmVhZCBldmVudHMgb24gaGFzTWFueSByZWxhdGlvbnNoaXBzIHRvIG90aGVyIGRhdGFzdG9yZXMnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHRlc3RQbHVtcCA9IG5ldyBQbHVtcCh7IHR5cGVzOiBbVGVzdFR5cGVdIH0pO1xuICAgICAgICBsZXQgdGVzdEl0ZW07XG4gICAgICAgIGxldCBtZW1zdG9yZTtcbiAgICAgICAgcmV0dXJuIGFjdHVhbFN0b3JlLndyaXRlQXR0cmlidXRlcyh7XG4gICAgICAgICAgdHlwZU5hbWU6ICd0ZXN0cycsXG4gICAgICAgICAgYXR0cmlidXRlczogeyBuYW1lOiAncG90YXRvJyB9LFxuICAgICAgICB9KS50aGVuKChjcmVhdGVkT2JqZWN0KSA9PiB7XG4gICAgICAgICAgdGVzdEl0ZW0gPSBjcmVhdGVkT2JqZWN0O1xuICAgICAgICAgIHJldHVybiBleHBlY3QoYWN0dWFsU3RvcmUucmVhZCh7IHR5cGVOYW1lOiAndGVzdHMnLCBpZDogdGVzdEl0ZW0uaWQgfSkpXG4gICAgICAgICAgLnRvLmV2ZW50dWFsbHkuaGF2ZS5kZWVwLnByb3BlcnR5KCdhdHRyaWJ1dGVzLm5hbWUnLCAncG90YXRvJyk7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4gYWN0dWFsU3RvcmUud3JpdGVSZWxhdGlvbnNoaXBJdGVtKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nLCB7IGlkOiAxMDAgfSkpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBtZW1zdG9yZSA9IG5ldyBNZW1vcnlTdG9yZSgpO1xuICAgICAgICAgIHRlc3RQbHVtcC5hZGRTdG9yZShhY3R1YWxTdG9yZSk7XG4gICAgICAgICAgdGVzdFBsdW1wLmFkZFN0b3JlKG1lbXN0b3JlKTtcbiAgICAgICAgICByZXR1cm4gZXhwZWN0KG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0pKS50by5ldmVudHVhbGx5LmJlLm51bGw7XG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJldHVybiBhY3R1YWxTdG9yZS5yZWFkKHsgdHlwZU5hbWU6ICd0ZXN0cycsIGlkOiB0ZXN0SXRlbS5pZCB9LCAnY2hpbGRyZW4nKTtcbiAgICAgICAgfSkudGhlbigoKSA9PiBuZXcgQmx1ZWJpcmQoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSkpXG4gICAgICAgIC50aGVuKCgpID0+IG1lbXN0b3JlLnJlYWQoeyB0eXBlTmFtZTogJ3Rlc3RzJywgaWQ6IHRlc3RJdGVtLmlkIH0sICdjaGlsZHJlbicpKVxuICAgICAgICAudGhlbigodikgPT4gZXhwZWN0KHYucmVsYXRpb25zaGlwcy5jaGlsZHJlbikudG8uZGVlcC5lcXVhbChbe2lkOiAxMDB9XSkpXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHRlc3RQbHVtcC50ZWFyZG93bigpKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgbW9jaGEuYWZ0ZXIoKCkgPT4ge1xuICAgICAgcmV0dXJuIChzdG9yZS5hZnRlciB8fCAoKCkgPT4geyByZXR1cm47IH0pKShhY3R1YWxTdG9yZSk7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19
